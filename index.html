 <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> - Advanced Demographic Analytics Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        secondary: '#7C3AED',
                        accent: '#059669',
                        warning: '#D97706',
                        danger: '#DC2626'
                    }
                }
            }
        }
    </script>
    <style>
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .demographic-card { 
            transition: all 0.3s ease; 
            background: linear-gradient(135deg, #5D5CDE 0%, #7C3AED 100%);
        }
        .demographic-card:hover { 
            transform: translateY(-5px); 
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        .chart-container { position: relative; height: 400px; }
        .pyramid-bar { transition: all 0.3s ease; }
        .pyramid-bar:hover { opacity: 0.8; }
        .professional-gradient { background: linear-gradient(135deg, #5D5CDE, #7C3AED, #059669); }
        .stats-card { 
            background: linear-gradient(135deg, rgba(93, 92, 222, 0.1), rgba(124, 58, 237, 0.1));
            border: 1px solid rgba(93, 92, 222, 0.2);
        }
        .indicator-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        .excel-drop-zone {
            border: 2px dashed #5D5CDE;
            background: rgba(93, 92, 222, 0.05);
        }
        .excel-drop-zone.dragover {
            border-color: #059669;
            background: rgba(5, 150, 105, 0.1);
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 min-h-screen">
    <!-- Dark mode detection -->
    <script>
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });
    </script>

    <!-- Login Screen -->
    <div id="loginScreen" class="fixed inset-0 bg-gradient-to-br from-primary via-secondary to-accent flex items-center justify-center z-50">
        <div class="max-w-md w-full mx-4">
            <div class="bg-white dark:bg-gray-800 shadow-2xl rounded-2xl p-8 border border-gray-200 dark:border-gray-700 backdrop-blur-sm">
                <div class="text-center mb-8">
                    <div class="w-20 h-20 bg-gradient-to-br from-primary to-accent rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg">
                        <i class="fas fa-chart-pie text-white text-3xl"></i>
                    </div>
                    <h1 class="text-2xl font-bold text-gray-900 dark:text-white">Advanced Demographic Analytics Platform</h1>
                    <h2 class="text-lg font-semibold bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent">Population Informatics & Analytics</h2>
                    <p class="text-gray-600 dark:text-gray-400 mt-2">Demographic Analytics Platform</p>
                </div>
                
                <form id="loginForm">
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            <i class="fas fa-lock mr-2"></i>Access Password
                        </label>
                        <input 
                            type="password" 
                            id="passwordInput"
                            class="w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                            placeholder="Enter your secure password"
                            required
                        >
                    </div>
                    
                    <button 
                        type="submit"
                        class="w-full bg-gradient-to-r from-primary to-accent hover:from-purple-700 hover:to-green-600 text-white py-3 px-4 rounded-lg font-medium transition-all duration-200 shadow-lg"
                    >
                        <i class="fas fa-unlock mr-2"></i>
                        ACCESS PLATFORM
                    </button>
                </form>
                
                <div class="mt-6 text-center">
                    <p class="text-xs text-gray-500 dark:text-gray-400">
                        Professional Demographic Analysis • Population Informatics • Statistical Modeling
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="hidden">
        <!-- Header -->
        <header class="professional-gradient text-white shadow-2xl">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                <div class="text-center">
                    <div class="w-24 h-24 mx-auto mb-4 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                        <i class="fas fa-chart-pie text-4xl text-white"></i>
                    </div>
                    <h1 class="text-4xl font-bold mb-2">ADVANCED DEMOGRAPHIC ANALYSIS PLATFORM</h1>
                    <p class="text-xl text-blue-100 mb-2">Population Informatics & Analytics</p>
                    <p class="text-lg text-blue-200 mb-4">• Advanced Demographic Analytics Platform</p>
                    <div class="flex justify-center items-center space-x-6 text-sm">
                        <div class="flex items-center">
                            <i class="fas fa-users mr-2"></i>
                            <span>Population Analysis</span>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-chart-line mr-2"></i>
                            <span>Demographic Modeling</span>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-globe-americas mr-2"></i>
                            <span>Migration Studies</span>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-baby mr-2"></i>
                            <span>Mortality Analysis </span>
                        </div>  
                             <div class="flex items-center">
                            <i class="fas fa-baby mr-2"></i>
                            <span>Fertility Analysis</span>
                        </div>
                    </div>
                </div>
            </div>
        </header>

       <!-- Professional Credentials Banner -->
<div class="bg-white dark:bg-gray-800 shadow-lg border-b border-gray-200 dark:border-gray-700">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
        <div class="grid grid-cols-1 md:grid-cols-6 gap-4 text-center">
            <div class="stats-card p-4 rounded-lg">
                <div class="text-2xl font-bold text-primary">MSc</div>
                <div class="text-sm text-gray-600 dark:text-gray-400">Population Informatics</div>
            </div>
            <div class="stats-card p-4 rounded-lg">
                <div class="text-2xl font-bold text-accent">20+</div>
                <div class="text-sm text-gray-600 dark:text-gray-400">Demographic Indicators</div>
            </div>
            <div class="stats-card p-4 rounded-lg">
                <div class="text-2xl font-bold text-warning">Excel</div>
                <div class="text-sm text-gray-600 dark:text-gray-400">Data Integration</div>
            </div>
            <div class="stats-card p-4 rounded-lg">
                <div class="text-2xl font-bold text-info">HTML</div>
                <div class="text-sm text-gray-600 dark:text-gray-400">Web Development</div>
            </div>
            <div class="stats-card p-4 rounded-lg">
                <div class="text-2xl font-bold text-info">Python</div>
                <div class="text-sm text-gray-600 dark:text-gray-400">Data Analysis</div>
            </div>
            <div class="stats-card p-4 rounded-lg">
                <div class="text-2xl font-bold text-info">R</div>
                <div class="text-sm text-gray-600 dark:text-gray-400">Data Visualization</div>
            </div>
            <div class="stats-card p-4 rounded-lg">
                <div class="text-2xl font-bold text-info">Stata</div>
                <div class="text-sm text-gray-600 dark:text-gray-400">Statistical Analysis</div>
            </div>
            <div class="stats-card p-4 rounded-lg">
                <div class="text-2xl font-bold text-info">Epi Info</div>
                <div class="text-sm text-gray-600 dark:text-gray-400">Epidemiological Analysis</div>
            </div>
        </div>
        <div class="mt-4 text-center">
            <h3 class="text-lg font-semibold">Proficiency in:</h3>
            <ul class="list-disc list-inside text-gray-700 dark:text-gray-300">
                <li>Demographic Software</li>
                <li>Statistical Software</li>
                <li>Data Integration Tools</li>
                <li>Data Visualization Tools</li>
            </ul>
        </div>
    </div>
</div>
        <!-- Navigation -->
        <nav class="bg-white dark:bg-gray-800 shadow-md sticky top-0 z-40">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex space-x-0 overflow-x-auto">
                    <button onclick="switchTab('basic-calculations')" id="basic-calculations-tab" class="tab-button flex items-center px-6 py-4 font-medium border-b-2 border-primary text-primary whitespace-nowrap">
                        <i class="fas fa-calculator mr-2"></i>Basic Calculations
                    </button>
                    <button onclick="switchTab('comprehensive-indicators')" id="comprehensive-indicators-tab" class="tab-button flex items-center px-6 py-4 font-medium border-b-2 border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 whitespace-nowrap">
                        <i class="fas fa-chart-bar mr-2"></i>All Indicators
                    </button>
                    <button onclick="switchTab('population-pyramids')" id="population-pyramids-tab" class="tab-button flex items-center px-6 py-4 font-medium border-b-2 border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 whitespace-nowrap">
                        <i class="fas fa-layer-group mr-2"></i>Population Pyramids
                    </button>
                    <button onclick="switchTab('life-tables')" id="life-tables-tab" class="tab-button flex items-center px-6 py-4 font-medium border-b-2 border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 whitespace-nowrap">
                        <i class="fas fa-table mr-2"></i>Life Tables
                    </button>
                    <button onclick="switchTab('projections')" id="projections-tab" class="tab-button flex items-center px-6 py-4 font-medium border-b-2 border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 whitespace-nowrap">
                        <i class="fas fa-crystal-ball mr-2"></i>Projections
                    </button>
                    <button onclick="switchTab('excel-tools')" id="excel-tools-tab" class="tab-button flex items-center px-6 py-4 font-medium border-b-2 border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 whitespace-nowrap">
                        <i class="fas fa-file-excel mr-2"></i>Excel Tools
                    </button>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Basic Calculations Tab -->
            <div id="basic-calculations-content" class="tab-content active">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-4">Basic Demographic Calculations</h2>
                    <p class="text-lg text-gray-600 dark:text-gray-400">Start with fundamental demographic calculations and rates</p>
                </div>

              <!-- Simple Calculators Grid -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    <!-- Crude Birth Rate -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
        <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center">
            <i class="fas fa-baby text-accent mr-2"></i>Crude Birth Rate
        </h3>
        <div class="space-y-3">
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Total Births</label>
                <input type="number" id="totalBirths" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Total Population</label>
                <input type="number" id="totalPopBirth" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
            </div>
            <button onclick="calculateCBR()" class="w-full bg-accent text-white py-2 px-4 rounded-lg">Calculate CBR</button>
            <div id="cbrResult" class="text-center font-bold text-accent text-lg"></div>
        </div>
    </div>

    <!-- Net Migration Rate -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
        <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center">
            <i class="fas fa-plane text-accent mr-2"></i>Net Migration Rate
        </h3>
        <div class="space-y-3">
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Total Immigrants</label>
                <input type="number" id="totalImmigrants" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Total Emigrants</label>
                <input type="number" id="totalEmigrants" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Total Population</label>
                <input type="number" id="totalPopMigration" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
            </div>
            <button onclick="calculateNMR()" class="w-full bg-accent text-white py-2 px-4 rounded-lg">Calculate NMR</button>
            <div id="nmrResult" class="text-center font-bold text-accent text-lg"></div>
        </div>
    </div>

    <!-- Mortality Rate -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
        <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center">
            <i class="fas fa-skull-crossbones text-accent mr-2"></i>Mortality Rate
        </h3>
        <div class="space-y-3">
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Total Deaths</label>
                <input type="number" id="totalDeaths" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Total Population</label>
                <input type="number" id="totalPopMortality" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
            </div>
            <button onclick="calculateMortalityRate()" class="w-full bg-accent text-white py-2 px-4 rounded-lg">Calculate Mortality Rate</button>
            <div id="mortalityResult" class="text-center font-bold text-accent text-lg"></div>
        </div>
    </div>

    <!-- SMAAM -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
        <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center">
            <i class="fas fa-chart-line text-accent mr-2"></i>SMAAM
        </h3>
        <div class="space-y-3">
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Age-Specific Death Rate</label>
                <input type="number" id="ageSpecificDeathRate" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Population in Age Group</label>
                <input type="number" id="populationAgeGroup" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
            </div>
            <button onclick="calculateSMAAM()" class="w-full bg-accent text-white py-2 px-4 rounded-lg">Calculate SMAAM</button>
            <div id="smaamResult" class="text-center font-bold text-accent text-lg"></div>
        </div>
    </div>

    <!-- Gompertz Model -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
        <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center">
            <i class="fas fa-calculator text-accent mr-2"></i>Gompertz Model
        </h3>
        <div class="space-y-3">
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Initial Population</label>
                <input type="number" id="initialPopulation" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Growth Rate</label>
                <input type="number" id="growthRate" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
            </div>
            <button onclick="calculateGompertz()" class="w-full bg-accent text-white py-2 px-4 rounded-lg">Calculate Gompertz</button>
            <div id="gompertzResult" class="text-center font-bold text-accent text-lg"></div>
        </div>
    </div>

    <!-- Sullivan Method -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
        <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center">
            <i class="fas fa-user-clock text-accent mr-2"></i>Sullivan Method
        </h3>
        <div class="space-y-3">
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Life Expectancy</label>
                <input type="number" id="lifeExpectancy" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Years Lived with Disability</label>
                <input type="number" id="yearsLivedDisability" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
            </div>
            <button onclick="calculateSullivan()" class="w-full bg-accent text-white py-2 px-4 rounded-lg">Calculate Sullivan</button>
            <div id="sullivanResult" class="text-center font-bold text-accent text-lg"></div>
        </div>
    </div>

    <!-- Fecundity -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
        <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center">
            <i class="fas fa-female text-accent mr-2"></i>Fecundity
        </h3>
        <div class="space-y-3">
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Total Live Births</label>
                <input type="number" id="totalLiveBirths" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Total Women of Childbearing Age</label>
                <input type="number" id="totalWomenChildbearing" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
            </div>
            <button onclick="calculateFecundity()" class="w-full bg-accent text-white py-2 px-4 rounded-lg">Calculate Fecundity</button>
            <div id="fecundityResult" class="text-center font-bold text-accent text-lg"></div>
        </div>
    </div>
</div>

<script>
    function calculateCBR() {
        const totalBirths = parseFloat(document.getElementById('totalBirths').value);
        const totalPopBirth = parseFloat(document.getElementById('totalPopBirth').value);
        const cbr = (totalBirths / totalPopBirth) * 1000;
        document.getElementById('cbrResult').innerText = `CBR: ${cbr.toFixed(2)} per 1,000`;
    }

    function calculateNMR() {
        const totalImmigrants = parseFloat(document.getElementById('totalImmigrants').value);
        const totalEmigrants = parseFloat(document.getElementById('totalEmigrants').value);
        const totalPopMigration = parseFloat(document.getElementById('totalPopMigration').value);
        const nmr = ((totalImmigrants - totalEmigrants) / totalPopMigration) * 1000;
        document.getElementById('nmrResult').innerText = `NMR: ${nmr.toFixed(2)} per 1,000`;
    }

    function calculateMortalityRate() {
        const totalDeaths = parseFloat(document.getElementById('totalDeaths').value);
        const totalPopMortality = parseFloat(document.getElementById('totalPopMortality').value);
        const mortalityRate = (totalDeaths / totalPopMortality) * 1000;
        document.getElementById('mortalityResult').innerText = `Mortality Rate: ${mortalityRate.toFixed(2)} per 1,000`;
    }

    function calculateSMAAM() {
        const ageSpecificDeathRate = parseFloat(document.getElementById('ageSpecificDeathRate').value);
        const populationAgeGroup = parseFloat(document.getElementById('populationAgeGroup').value);
        const smaam = ageSpecificDeathRate * populationAgeGroup;
        document.getElementById('smaamResult').innerText = `SMAAM: ${smaam.toFixed(2)}`;
    }

    function calculateGompertz() {
        const initialPopulation = parseFloat(document.getElementById('initialPopulation').value);
        const growthRate = parseFloat(document.getElementById('growthRate').value);
        const gompertz = initialPopulation * Math.exp(growthRate); // Simplified model
        document.getElementById('gompertzResult').innerText = `Gompertz Population: ${gompertz.toFixed(2)}`;
    }

    function calculateSullivan() {
        const lifeExpectancy = parseFloat(document.getElementById('lifeExpectancy').value);
        const yearsLivedDisability = parseFloat(document.getElementById('yearsLivedDisability').value);
        const healthyLifeYears = lifeExpectancy - yearsLivedDisability;
        document.getElementById('sullivanResult').innerText = `Healthy Life Years: ${healthyLifeYears.toFixed(2)}`;
    }

    function calculateFecundity() {
        const totalLiveBirths = parseFloat(document.getElementById('totalLiveBirths').value);
        const totalWomenChildbearing = parseFloat(document.getElementById('totalWomenChildbearing').value);
        const fecundity = totalLiveBirths / totalWomenChildbearing;
        document.getElementById('fecundityResult').innerText = `Fecundity: ${fecundity.toFixed(2)}`;
    }
</script>
                    </div>
              </div>
          </div>
  </div>

                    <!-- Crude Death Rate -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center">
                            <i class="fas fa-cross text-danger mr-2"></i>Crude Death Rate
                        </h3>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Total Deaths</label>
                                <input type="number" id="totalDeaths" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Total Population</label>
                                <input type="number" id="totalPopDeath" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                            </div>
                            <button onclick="calculateCDR()" class="w-full bg-danger text-white py-2 px-4 rounded-lg">Calculate CDR</button>
                            <div id="cdrResult" class="text-center font-bold text-danger text-lg"></div>
                        </div>
                    </div>

                    <!-- Population Growth Rate -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center">
                            <i class="fas fa-chart-line text-primary mr-2"></i>Growth Rate
                        </h3>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Initial Population</label>
                                <input type="number" id="initialPop" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Final Population</label>
                                <input type="number" id="finalPop" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Years</label>
                                <input type="number" id="timePeriod" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                            </div>
                            <button onclick="calculateGrowthRate()" class="w-full bg-primary text-white py-2 px-4 rounded-lg">Calculate</button>
                            <div id="growthRateResult" class="text-center font-bold text-primary text-lg"></div>
                        </div>
                    </div>

                    <!-- Dependency Ratio -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center">
                            <i class="fas fa-balance-scale text-secondary mr-2"></i>Dependency Ratio
                        </h3>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Population 0-14</label>
                                <input type="number" id="pop0to14" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Population 15-64</label>
                                <input type="number" id="pop15to64" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Population 65+</label>
                                <input type="number" id="pop65plus" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                            </div>
                            <button onclick="calculateDependencyRatio()" class="w-full bg-secondary text-white py-2 px-4 rounded-lg">Calculate</button>
                            <div id="dependencyResult" class="text-center font-bold text-secondary text-sm space-y-1"></div>
                        </div>
                    </div>

                    <!-- Sex Ratio -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center">
                            <i class="fas fa-venus-mars text-warning mr-2"></i>Sex Ratio
                        </h3>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Male Population</label>
                                <input type="number" id="malePopulation" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Female Population</label>
                                <input type="number" id="femalePopulation" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                            </div>
                            <button onclick="calculateSexRatio()" class="w-full bg-warning text-white py-2 px-4 rounded-lg">Calculate</button>
                            <div id="sexRatioResult" class="text-center font-bold text-warning text-lg"></div>
                        </div>
                    </div>

                    <!-- Doubling Time -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center">
                            <i class="fas fa-clock text-accent mr-2"></i>Doubling Time
                        </h3>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Growth Rate (%)</label>
                                <input type="number" id="growthRateDoubling" step="0.1" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                            </div>
                            <button onclick="calculateDoublingTime()" class="w-full bg-accent text-white py-2 px-4 rounded-lg">Calculate</button>
                            <div id="doublingTimeResult" class="text-center font-bold text-accent text-lg"></div>
                            <div class="text-xs text-gray-500 dark:text-gray-400 text-center">Formula: 70 / growth rate</div>
                        </div>
                    </div>
                </div>

                <!-- Excel Import for Basic Calculations -->
                <div class="mt-8 bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">
                        <i class="fas fa-file-excel text-accent mr-2"></i>Import Excel Data for Basic Calculations
                    </h3>
                    <div class="excel-drop-zone rounded-lg p-8 text-center" id="basicCalcDropZone">
                        <i class="fas fa-upload text-4xl text-primary mb-4"></i>
                        <p class="text-lg font-medium text-gray-700 dark:text-gray-300 mb-2">Drop Excel file here or click to browse</p>
                        <p class="text-sm text-gray-500 dark:text-gray-400 mb-4">Supported formats: .xlsx, .xls</p>
                        <input type="file" id="basicCalcFile" class="hidden" accept=".xlsx,.xls">
                        <button onclick="document.getElementById('basicCalcFile').click()" class="bg-primary text-white px-6 py-3 rounded-lg font-medium hover:bg-purple-700">
                            Select Excel File
                        </button>
                    </div>
                    <div id="basicCalcExcelPreview" class="mt-4 hidden">
                        <h4 class="font-bold text-gray-900 dark:text-white mb-2">Data Preview:</h4>
                        <div class="overflow-x-auto">
                            <table id="basicCalcTable" class="min-w-full text-sm border border-gray-300 dark:border-gray-600"></table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Comprehensive Demographic Indicators Tab -->
            <div id="comprehensive-indicators-content" class="tab-content">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-4">Advanced Demographic Analytics Platform</h2>
                    <p class="text-lg text-gray-600 dark:text-gray-400">Complete demographic indicators, survival analysis models, and Excel integration</p>
                </div>

                <!-- Advanced Indicators Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                
                    <!-- Population Size and Distribution Section -->
                    <div class="md:col-span-3 bg-gray-50 dark:bg-gray-700 p-4 rounded-lg mb-6">
                        <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">
                            <i class="fas fa-users text-primary mr-2"></i>Population Size and Distribution
                        </h3>
                        <p class="text-sm text-gray-600 dark:text-gray-400">Total population, density, and age structure analysis</p>
                    </div>

                    <!-- Total Population -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center">
                            <i class="fas fa-calculator text-primary mr-2"></i>Total Population
                        </h3>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Population Count</label>
                                <input type="number" id="totalPopulation" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Reference Year</label>
                                <input type="number" id="popRefYear" value="2023" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                            </div>
                            <button onclick="calculateTotalPop()" class="w-full bg-primary text-white py-2 px-4 rounded-lg">Calculate</button>
                            <div id="totalPopResult" class="text-center font-bold text-primary text-lg"></div>
                        </div>
                    </div>

                    <!-- Population Density -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center">
                            <i class="fas fa-map text-accent mr-2"></i>Population Density
                        </h3>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Population</label>
                                <input type="number" id="popForDensity" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Area (km²)</label>
                                <input type="number" id="totalArea" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                            </div>
                            <button onclick="calculatePopDensity()" class="w-full bg-accent text-white py-2 px-4 rounded-lg">Calculate Density</button>
                            <div id="densityResult" class="text-center font-bold text-accent text-lg"></div>
                        </div>
                    </div>

                    <!-- Natural Increase -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center">
                            <i class="fas fa-trending-up text-secondary mr-2"></i>Natural Increase
                        </h3>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Birth Rate (/1000)</label>
                                <input type="number" id="birthRateNI" step="0.1" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Death Rate (/1000)</label>
                                <input type="number" id="deathRateNI" step="0.1" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                            </div>
                            <button onclick="calculateNaturalIncrease()" class="w-full bg-secondary text-white py-2 px-4 rounded-lg">Calculate</button>
                            <div id="naturalIncreaseResult" class="text-center font-bold text-secondary text-lg"></div>
                        </div>
                    </div>

                    <!-- Fertility Measures Section -->
                    <div class="md:col-span-3 bg-gray-50 dark:bg-gray-700 p-4 rounded-lg mb-6 mt-6">
                        <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">
                            <i class="fas fa-baby text-secondary mr-2"></i>Fertility Measures
                        </h3>
                        <p class="text-sm text-gray-600 dark:text-gray-400">Comprehensive fertility analysis including TFR, GFR, ASFR, and reproduction rates</p>
                    </div>
                    <!-- Total Fertility Rate -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center">
                            <i class="fas fa-female text-secondary mr-2"></i>Total Fertility Rate
                        </h3>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">ASFR (comma-separated)</label>
                                <textarea id="asfrRates" placeholder="0.02, 0.15, 0.18, 0.16, 0.12, 0.08, 0.03" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 h-20 resize-none"></textarea>
                            </div>
                            <button onclick="calculateTFR()" class="w-full bg-secondary text-white py-2 px-4 rounded-lg">Calculate TFR</button>
                            <div id="tfrResult" class="text-center font-bold text-secondary text-lg"></div>
                        </div>
                    </div>

                    <!-- General Fertility Rate -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center">
                            <i class="fas fa-chart-area text-accent mr-2"></i>General Fertility Rate
                        </h3>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Total Births</label>
                                <input type="number" id="gfrBirths" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Women 15-49</label>
                                <input type="number" id="women15to49" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                            </div>
                            <button onclick="calculateGFR()" class="w-full bg-accent text-white py-2 px-4 rounded-lg">Calculate GFR</button>
                            <div id="gfrResult" class="text-center font-bold text-accent text-lg"></div>
                        </div>
                    </div>

                    <!-- Gross Reproduction Rate -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center">
                            <i class="fas fa-baby-carriage text-primary mr-2"></i>Gross Reproduction Rate
                        </h3>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Female ASFR</label>
                                <textarea id="femaleASFR" placeholder="0.01, 0.075, 0.09, 0.08, 0.06, 0.04, 0.015" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 h-20 resize-none"></textarea>
                            </div>
                            <button onclick="calculateGRR()" class="w-full bg-primary text-white py-2 px-4 rounded-lg">Calculate GRR</button>
                            <div id="grrResult" class="text-center font-bold text-primary text-lg"></div>
                        </div>
                    </div>

                    <!-- Net Reproduction Rate -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center">
                            <i class="fas fa-chart-line text-warning mr-2"></i>Net Reproduction Rate
                        </h3>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Female ASFR</label>
                                <textarea id="nrrASFR" placeholder="0.01, 0.075, 0.09, 0.08, 0.06, 0.04, 0.015" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 h-16 resize-none"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Survival Ratios (Lx/L0)</label>
                                <textarea id="survivalRatios" placeholder="0.98, 0.97, 0.96, 0.95, 0.93, 0.90, 0.85" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 h-16 resize-none"></textarea>
                            </div>
                            <button onclick="calculateNRR()" class="w-full bg-warning text-white py-2 px-4 rounded-lg">Calculate NRR</button>
                            <div id="nrrResult" class="text-center font-bold text-warning text-lg"></div>
                        </div>
                    </div>

                    <!-- Infant Mortality Rate -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center">
                            <i class="fas fa-heartbeat text-danger mr-2"></i>Infant Mortality Rate
                        </h3>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Infant Deaths (0-1 year)</label>
                                <input type="number" id="infantDeaths" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Live Births</label>
                                <input type="number" id="liveBirths" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                            </div>
                            <button onclick="calculateIMR()" class="w-full bg-danger text-white py-2 px-4 rounded-lg">Calculate IMR</button>
                            <div id="imrResult" class="text-center font-bold text-danger text-lg"></div>
                        </div>
                    </div>

                    <!-- Child Mortality Rate -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center">
                            <i class="fas fa-child text-secondary mr-2"></i>Child Mortality Rate
                        </h3>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Deaths Under 5</label>
                                <input type="number" id="under5Deaths" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Live Births</label>
                                <input type="number" id="cmrLiveBirths" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                            </div>
                            <button onclick="calculateCMR()" class="w-full bg-secondary text-white py-2 px-4 rounded-lg">Calculate CMR</button>
                            <div id="cmrResult" class="text-center font-bold text-secondary text-lg"></div>
                        </div>
                    </div>

                    <!-- Maternal Mortality Rate -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center">
                            <i class="fas fa-female text-primary mr-2"></i>Maternal Mortality Rate
                        </h3>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Maternal Deaths</label>
                                <input type="number" id="maternalDeaths" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Live Births</label>
                                <input type="number" id="mmrLiveBirths" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                            </div>
                            <button onclick="calculateMMR()" class="w-full bg-primary text-white py-2 px-4 rounded-lg">Calculate MMR</button>
                            <div id="mmrResult" class="text-center font-bold text-primary text-lg"></div>
                        </div>
                    </div>

                    <!-- Net Migration Rate -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center">
                            <i class="fas fa-exchange-alt text-accent mr-2"></i>Net Migration Rate
                        </h3>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Immigration</label>
                                <input type="number" id="immigration" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Emigration</label>
                                <input type="number" id="emigration" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Total Population</label>
                                <input type="number" id="totalPopMigration" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                            </div>
                            <button onclick="calculateNMR()" class="w-full bg-accent text-white py-2 px-4 rounded-lg">Calculate NMR</button>
                            <div id="nmrResult" class="text-center font-bold text-accent text-lg"></div>
                        </div>
                    </div>

                    <!-- Mean Generation Time -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center">
                            <i class="fas fa-hourglass-half text-warning mr-2"></i>Mean Generation Time
                        </h3>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Age-specific Fertility (x ASFR)</label>
                                <textarea id="ageSpecificFertility" placeholder="17.5*0.02, 22.5*0.15, 27.5*0.18..." class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 h-20 resize-none"></textarea>
                            </div>
                            <button onclick="calculateMGT()" class="w-full bg-warning text-white py-2 px-4 rounded-lg">Calculate MGT</button>
                            <div id="mgtResult" class="text-center font-bold text-warning text-lg"></div>
                        </div>
                    </div>
                </div>

                <!-- Excel Integration Section -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-8">
                    <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">
                        <i class="fas fa-file-excel text-primary mr-2"></i>Excel Data Integration for All Indicators
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="excel-drop-zone rounded-lg p-6 text-center" id="comprehensiveDropZone">
                            <i class="fas fa-upload text-3xl text-primary mb-3"></i>
                            <p class="font-medium text-gray-700 dark:text-gray-300 mb-2">Upload Demographic Data</p>
                            <p class="text-sm text-gray-500 dark:text-gray-400 mb-3">Excel file with population, births, deaths data</p>
                            <input type="file" id="comprehensiveFile" class="hidden" accept=".xlsx,.xls">
                            <button onclick="document.getElementById('comprehensiveFile').click()" class="bg-primary text-white px-4 py-2 rounded-lg text-sm">
                                Select File
                            </button>
                        </div>
                        <div class="space-y-4">
                            <h4 class="font-bold text-gray-900 dark:text-white">Auto-Calculate Features:</h4>
                            <div class="space-y-2 text-sm">
                                <div class="flex items-center">
                                    <i class="fas fa-check-circle text-accent mr-2"></i>
                                    <span>Automatic rate calculations from Excel columns</span>
                                </div>
                                <div class="flex items-center">
                                    <i class="fas fa-check-circle text-accent mr-2"></i>
                                    <span>Age-specific fertility rate processing</span>
                                </div>
                                <div class="flex items-center">
                                    <i class="fas fa-check-circle text-accent mr-2"></i>
                                    <span>Population structure analysis</span>
                                </div>
                                <div class="flex items-center">
                                    <i class="fas fa-check-circle text-accent mr-2"></i>
                                    <span>Batch indicator calculations</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="comprehensiveExcelResults" class="mt-6 hidden">
                        <h4 class="font-bold text-gray-900 dark:text-white mb-4">Calculated Indicators from Excel Data:</h4>
                        <div id="excelIndicatorResults" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
                    </div>
                </div>
            </div>

            <!-- Population Pyramids Tab -->
            <div id="population-pyramids-content" class="tab-content">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-4">Population Pyramid Builder</h2>
                    <p class="text-lg text-gray-600 dark:text-gray-400">Create and analyze population pyramids with Excel data support</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Pyramid Controls -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">Pyramid Configuration</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Country/Region Name</label>
                                <input type="text" id="pyramidTitle" placeholder="e.g., Zimbabwe, 2023" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Pyramid Type</label>
                                <select id="pyramidType" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                                    <option value="expansive">Expansive (Young Population)</option>
                                    <option value="constrictive">Constrictive (Aging Population)</option>
                                    <option value="stationary">Stationary (Stable Population)</option>
                                    <option value="excel">Excel Data</option>
                                </select>
                            </div>
                            <button onclick="generatePyramid()" class="w-full bg-primary text-white py-2 px-4 rounded-lg">
                                Generate Pyramid
                            </button>
                            
                            <div id="pyramidExcelUpload" class="excel-drop-zone rounded-lg p-4 text-center">
                                <i class="fas fa-file-excel text-2xl text-primary mb-2"></i>
                                <p class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Upload Age-Sex Excel Data</p>
                                <input type="file" id="pyramidDataFile" accept=".xlsx,.xls" class="hidden">
                                <button onclick="document.getElementById('pyramidDataFile').click()" class="bg-primary text-white px-4 py-2 rounded-lg text-sm">
                                    Select Excel File
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Pyramid Visualization -->
                    <div class="lg:col-span-2 bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">Population Pyramid</h3>
                        <div class="chart-container">
                            <canvas id="populationPyramid"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Pyramid Analysis -->
                <div class="mt-8 bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">Pyramid Analysis</h3>
                    <div id="pyramidAnalysis" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <p class="text-gray-500 dark:text-gray-400 text-center py-8 md:col-span-3">Generate a pyramid to see analysis</p>
                    </div>
                </div>
            </div>

            <!-- Life Tables Tab -->
            <div id="life-tables-content" class="tab-content">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-4">Life Table Construction</h2>
                    <p class="text-lg text-gray-600 dark:text-gray-400">Build complete life tables with Excel mortality data import</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Life Table Input -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">Mortality Data Input</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Age-Specific Death Rates (per 1,000)</label>
                                <textarea id="mortalityRates" placeholder="8.5, 1.2, 0.3, 0.4, 0.5, 0.6, 0.8, 1.0..." class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 h-32 resize-none"></textarea>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Population Type</label>
                                    <select id="populationType" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                                        <option value="both">Both Sexes</option>
                                        <option value="male">Male</option>
                                        <option value="female">Female</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Radix (l₀)</label>
                                    <input type="number" id="radix" value="100000" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                                </div>
                            </div>
                            <div class="excel-drop-zone rounded-lg p-4 text-center">
                                <i class="fas fa-file-excel text-2xl text-primary mb-2"></i>
                                <p class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Import Mortality Data from Excel</p>
                                <input type="file" id="mortalityExcelFile" accept=".xlsx,.xls" class="hidden">
                                <button onclick="document.getElementById('mortalityExcelFile').click()" class="bg-primary text-white px-4 py-2 rounded-lg text-sm">
                                    Select Excel File
                                </button>
                            </div>
                            <button onclick="constructLifeTable()" class="w-full bg-primary text-white py-2 px-4 rounded-lg">
                                Construct Life Table
                            </button>
                            <button onclick="loadSampleMortality()" class="w-full bg-secondary text-white py-2 px-4 rounded-lg">
                                Load Sample Data
                            </button>
                        </div>
                    </div>

                    <!-- Life Table Results -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">Life Table Summary</h3>
                        <div id="lifeTableSummary" class="space-y-4">
                            <p class="text-gray-500 dark:text-gray-400 text-center py-8">Construct life table to see results</p>
                        </div>
                    </div>
                </div>

                <!-- Complete Life Table Display -->
                <div class="mt-8 bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">Complete Life Table</h3>
                    <div id="lifeTableDisplay" class="overflow-x-auto">
                        <p class="text-gray-500 dark:text-gray-400 text-center py-8">Life table will appear here</p>
                    </div>
                </div>
            </div>

            <!-- Population Projections Tab -->
            <div id="projections-content" class="tab-content">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-4">Population Projections</h2>
                    <p class="text-lg text-gray-600 dark:text-gray-400">Project future population using Excel base data and demographic parameters</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                    <!-- Projection Parameters -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">Projection Parameters</h3>
                        <div class="space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Base Year</label>
                                    <input type="number" id="baseYear" value="2023" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Target Year</label>
                                    <input type="number" id="targetYear" value="2050" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Base Population</label>
                                <input type="number" id="basePopulation" value="15000000" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                            </div>
                            <div class="grid grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Birth Rate (/1000)</label>
                                    <input type="number" id="birthRate" value="25" step="0.1" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Death Rate (/1000)</label>
                                    <input type="number" id="deathRate" value="8" step="0.1" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Migration Rate (/1000)</label>
                                    <input type="number" id="migrationRate" value="-2" step="0.1" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                                </div>
                            </div>
                            <div class="excel-drop-zone rounded-lg p-4 text-center">
                                <i class="fas fa-file-excel text-2xl text-primary mb-2"></i>
                                <p class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Import Base Population Data</p>
                                <input type="file" id="projectionExcelFile" accept=".xlsx,.xls" class="hidden">
                                <button onclick="document.getElementById('projectionExcelFile').click()" class="bg-primary text-white px-4 py-2 rounded-lg text-sm">
                                    Select Excel File
                                </button>
                            </div>
                            <button onclick="calculateProjections()" class="w-full bg-primary text-white py-2 px-4 rounded-lg">
                                Calculate Projections
                            </button>
                        </div>
                    </div>

                    <!-- Projection Results -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">Projection Summary</h3>
                        <div id="projectionSummary" class="space-y-4">
                            <p class="text-gray-500 dark:text-gray-400 text-center py-8">Run projection to see results</p>
                        </div>
                    </div>
                </div>

                <!-- Projection Chart -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">Population Projection Chart</h3>
                    <div class="chart-container">
                        <canvas id="projectionChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Excel Tools Tab -->
            <div id="excel-tools-content" class="tab-content">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-4">Excel Integration Tools</h2>
                    <p class="text-lg text-gray-600 dark:text-gray-400">Advanced Excel data processing and batch analysis tools</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                    <!-- Excel Data Processor -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">
                            <i class="fas fa-cogs text-primary mr-2"></i>Excel Data Processor
                        </h3>
                        <div class="space-y-4">
                            <div class="excel-drop-zone rounded-lg p-6 text-center" id="mainExcelDropZone">
                                <i class="fas fa-upload text-4xl text-primary mb-4"></i>
                                <p class="text-lg font-medium text-gray-700 dark:text-gray-300 mb-2">Drop Excel file here</p>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-4">or click to browse files</p>
                                <input type="file" id="mainExcelFile" class="hidden" accept=".xlsx,.xls">
                                <button onclick="document.getElementById('mainExcelFile').click()" class="bg-primary text-white px-6 py-3 rounded-lg font-medium">
                                    Select Excel File
                                </button>
                            </div>
                            <div id="excelProcessingOptions" class="hidden space-y-3">
                                <h4 class="font-bold text-gray-900 dark:text-white">Processing Options:</h4>
                                <div class="space-y-2">
                                    <label class="flex items-center">
                                        <input type="checkbox" id="autoCalculateRates" checked class="mr-2">
                                        <span class="text-sm">Auto-calculate demographic rates</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" id="generatePyramid" checked class="mr-2">
                                        <span class="text-sm">Generate population pyramid</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" id="createLifeTable" class="mr-2">
                                        <span class="text-sm">Create life table (if mortality data available)</span>
                                    </label>
                                </div>
                                <button onclick="processExcelData()" class="w-full bg-accent text-white py-2 px-4 rounded-lg">
                                    Process Data
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Data Preview -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">Data Preview</h3>
                        <div id="excelDataPreview" class="h-96 overflow-auto border border-gray-300 dark:border-gray-600 rounded-lg p-4">
                            <p class="text-gray-500 dark:text-gray-400 text-center py-8">Upload Excel file to preview data</p>
                        </div>
                    </div>
                </div>

                <!-- Batch Results -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-8">
                    <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">
                        <i class="fas fa-chart-pie text-accent mr-2"></i>Batch Analysis Results
                    </h3>
                    <div id="batchResults" class="space-y-6">
                        <p class="text-gray-500 dark:text-gray-400 text-center py-8">Process Excel data to see batch analysis results</p>
                    </div>
                </div>

                <!-- Report Generation -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">
                        <i class="fas fa-file-pdf text-danger mr-2"></i>Generate Comprehensive Report
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Report Title</label>
                                <input type="text" id="reportTitle" placeholder="Demographic Analysis Report - Zimbabwe 2023" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Analysis Date</label>
                                <input type="date" id="analysisDate" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Report Type</label>
                                <select id="reportType" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                                    <option value="comprehensive">Comprehensive Analysis</option>
                                    <option value="basic">Basic Indicators</option>
                                    <option value="fertility">Fertility Analysis</option>
                                    <option value="mortality">Mortality Analysis</option>
                                </select>
                            </div>
                            <button onclick="generateDemographicReport()" class="w-full bg-danger text-white py-2 px-4 rounded-lg">
                                Generate PDF Report
                            </button>
                        </div>
                        <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                            <h4 class="font-bold text-gray-900 dark:text-white mb-3">Report Features:</h4>
                            <div class="space-y-2 text-sm text-gray-700 dark:text-gray-300">
                                <div class="flex items-center">
                                    <i class="fas fa-check-circle text-accent mr-2"></i>
                                    <span>Professional formatting with UZ branding</span>
                                </div>
                                <div class="flex items-center">
                                    <i class="fas fa-check-circle text-accent mr-2"></i>
                                    <span>All calculated demographic indicators</span>
                                </div>
                                <div class="flex items-center">
                                    <i class="fas fa-check-circle text-accent mr-2"></i>
                                    <span>Population pyramids and charts</span>
                                </div>
                                <div class="flex items-center">
                                    <i class="fas fa-check-circle text-accent mr-2"></i>
                                    <span>Life tables and projections</span>
                                </div>
                                <div class="flex items-center">
                                    <i class="fas fa-check-circle text-accent mr-2"></i>
                                    <span>Professional demographic analysis</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="professional-gradient text-white mt-16">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                <div class="text-center">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-8">
                        <div>
                            <h3 class="text-lg font-bold mb-4">Academic Credentials</h3>
                            <ul class="space-y-2 text-blue-100">
                                <li>Master of Science</li>
                                <li>Population Informatics & Analytics</li>
                                <li>University of Zimbabwe</li>
                                <li>Professional Demographer</li>
                            </ul>
                        </div>
                        <div>
                            <h3 class="text-lg font-bold mb-4">Expertise Areas</h3>
                            <ul class="space-y-2 text-blue-100">
                                <li>Population Dynamics Analysis</li>
                                <li>Demographic Modeling & Projections</li>
                                <li>Fertility & Mortality Studies</li>
                                <li>Excel Data Integration</li>
                            </ul>
                        </div>
                        <div>
                            <h3 class="text-lg font-bold mb-4">Platform Features</h3>
                            <ul class="space-y-2 text-blue-100">
                                <li>20+ Demographic Indicators</li>
                                <li>Excel Data Processing</li>
                                <li>Advanced Statistical Analysis</li>
                                <li>Professional Report Generation</li>
                            </ul>
                        </div>
                    </div>
                    <div class="border-t border-blue-400 pt-6">
                        <p class="text-blue-100 mb-2">&copy; 2024 Erasmus Gwidza - Population Analytics Platform</p>
                        <p class="text-blue-200 text-sm">Master of Science in Population Informatics & Analytics • University of Zimbabwe</p>
                        <p class="text-blue-300 text-xs mt-2">Advanced Demographic Analysis • Professional Excel Integration • Statistical Modeling</p>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <script>
        // Login System
        function handleLogin(event) {
            event.preventDefault();
            const password = document.getElementById('passwordInput').value;
            
            if (password === 'gwidza@2025') {
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
            } else {
                showCustomAlert('Invalid password. Please try again.');
                document.getElementById('passwordInput').value = '';
            }
        }

        // Custom Alert Function (replacing alert())
        function showCustomAlert(message) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full mx-4">
                    <p class="text-gray-700 dark:text-gray-300 mb-4">${message}</p>
                    <div class="flex justify-end">
                        <button class="px-4 py-2 bg-primary text-white hover:bg-purple-600 rounded" onclick="this.closest('.fixed').remove()">OK</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Custom Confirm Function
        function showCustomConfirm(message, onConfirm) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full mx-4">
                    <p class="text-gray-700 dark:text-gray-300 mb-4">${message}</p>
                    <div class="flex justify-end space-x-3">
                        <button class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded" onclick="this.closest('.fixed').remove()">Cancel</button>
                        <button class="px-4 py-2 bg-primary text-white hover:bg-purple-600 rounded" onclick="this.closest('.fixed').remove(); onConfirm()">Confirm</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Setup login form
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
        });

        // Application State
        let currentTab = 'basic-calculations';
        let excelData = null;
        let processedResults = {};
        let charts = {};

        // Tab Management
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('border-primary', 'text-primary');
                button.classList.add('border-transparent', 'text-gray-600', 'dark:text-gray-400');
            });

            document.getElementById(`${tabName}-content`).classList.add('active');

            const activeButton = document.getElementById(`${tabName}-tab`);
            if (activeButton) {
                activeButton.classList.add('border-primary', 'text-primary');
                activeButton.classList.remove('border-transparent', 'text-gray-600', 'dark:text-gray-400');
            }

            currentTab = tabName;
        }

        // Excel File Handling
        function setupExcelHandlers() {
            const fileInputs = [
                'basicCalcFile',
                'comprehensiveFile',
                'pyramidDataFile',
                'mortalityExcelFile',
                'projectionExcelFile',
                'mainExcelFile'
            ];

            fileInputs.forEach(inputId => {
                const input = document.getElementById(inputId);
                if (input) {
                    input.addEventListener('change', function(e) {
                        handleExcelFile(e.target.files[0], inputId);
                    });
                }
            });

            // Drag and drop functionality
            setupDragAndDrop();
        }

        function setupDragAndDrop() {
            const dropZones = document.querySelectorAll('.excel-drop-zone');
            
            dropZones.forEach(zone => {
                zone.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    zone.classList.add('dragover');
                });

                zone.addEventListener('dragleave', function(e) {
                    e.preventDefault();
                    zone.classList.remove('dragover');
                });

                zone.addEventListener('drop', function(e) {
                    e.preventDefault();
                    zone.classList.remove('dragover');
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        const context = zone.id.replace('DropZone', 'File');
                        handleExcelFile(files[0], context);
                    }
                });
            });
        }

        function handleExcelFile(file, context) {
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

                    excelData = {
                        raw: jsonData,
                        headers: jsonData[0] || [],
                        data: jsonData.slice(1),
                        fileName: file.name,
                        context: context
                    };

                    processExcelDataByContext(excelData, context);
                    showExcelPreview(excelData, context);

                } catch (error) {
                    console.error('Error reading Excel file:', error);
                    showCustomAlert('Error reading Excel file. Please check the file format.');
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function processExcelDataByContext(data, context) {
            switch(context) {
                case 'basicCalcFile':
                    processBasicCalculations(data);
                    break;
                case 'comprehensiveFile':
                    processComprehensiveIndicators(data);
                    break;
                case 'pyramidDataFile':
                    processPyramidData(data);
                    break;
                case 'mortalityExcelFile':
                    processMortalityData(data);
                    break;
                case 'projectionExcelFile':
                    processProjectionData(data);
                    break;
                case 'mainExcelFile':
                    processMainExcelData(data);
                    break;
            }
        }

        function showExcelPreview(data, context) {
            const previewId = getPreviewElementId(context);
            const previewElement = document.getElementById(previewId);
            
            if (!previewElement) return;

            let html = '<table class="w-full text-sm border-collapse border border-gray-300 dark:border-gray-600">';
            
            // Headers
            html += '<thead><tr class="bg-gray-100 dark:bg-gray-700">';
            data.headers.forEach(header => {
                html += `<th class="border border-gray-300 dark:border-gray-600 px-3 py-2 text-left">${header || 'Column'}</th>`;
            });
            html += '</tr></thead>';

            // Data rows (limit to first 10 for preview)
            html += '<tbody>';
            data.data.slice(0, 10).forEach(row => {
                html += '<tr class="hover:bg-gray-50 dark:hover:bg-gray-800">';
                data.headers.forEach((_, colIndex) => {
                    html += `<td class="border border-gray-300 dark:border-gray-600 px-3 py-2">${row[colIndex] || ''}</td>`;
                });
                html += '</tr>';
            });
            html += '</tbody></table>';

            if (data.data.length > 10) {
                html += `<p class="text-sm text-gray-500 dark:text-gray-400 mt-2">Showing 10 of ${data.data.length} rows</p>`;
            }

            previewElement.innerHTML = html;
            
            // Show preview section
            const previewSection = previewElement.closest('.hidden');
            if (previewSection) {
                previewSection.classList.remove('hidden');
            }
        }

        function getPreviewElementId(context) {
            const mapping = {
                'basicCalcFile': 'basicCalcTable',
                'comprehensiveFile': 'comprehensiveExcelResults',
                'mainExcelFile': 'excelDataPreview'
            };
            return mapping[context] || 'excelDataPreview';
        }

        // Basic Demographic Calculations
        function calculateCBR() {
            const births = parseFloat(document.getElementById('totalBirths').value);
            const population = parseFloat(document.getElementById('totalPopBirth').value);
            
            if (births && population) {
                const cbr = (births / population) * 1000;
                document.getElementById('cbrResult').textContent = `${cbr.toFixed(1)} per 1,000`;
            }
        }

        function calculateCDR() {
            const deaths = parseFloat(document.getElementById('totalDeaths').value);
            const population = parseFloat(document.getElementById('totalPopDeath').value);
            
            if (deaths && population) {
                const cdr = (deaths / population) * 1000;
                document.getElementById('cdrResult').textContent = `${cdr.toFixed(1)} per 1,000`;
            }
        }

        function calculateGrowthRate() {
            const initial = parseFloat(document.getElementById('initialPop').value);
            const final = parseFloat(document.getElementById('finalPop').value);
            const time = parseFloat(document.getElementById('timePeriod').value);
            
            if (initial && final && time) {
                const growthRate = (Math.pow(final / initial, 1 / time) - 1) * 100;
                document.getElementById('growthRateResult').textContent = `${growthRate.toFixed(2)}% per year`;
            }
        }

        function calculateDependencyRatio() {
            const pop0to14 = parseFloat(document.getElementById('pop0to14').value);
            const pop15to64 = parseFloat(document.getElementById('pop15to64').value);
            const pop65plus = parseFloat(document.getElementById('pop65plus').value);
            
            if (pop0to14 && pop15to64 && pop65plus) {
                const youthDR = (pop0to14 / pop15to64) * 100;
                const agingDR = (pop65plus / pop15to64) * 100;
                const totalDR = youthDR + agingDR;
                
                document.getElementById('dependencyResult').innerHTML = `
                    <div>Youth: ${youthDR.toFixed(1)}%</div>
                    <div>Aging: ${agingDR.toFixed(1)}%</div>
                    <div>Total: ${totalDR.toFixed(1)}%</div>
                `;
            }
        }

        function calculateSexRatio() {
            const male = parseFloat(document.getElementById('malePopulation').value);
            const female = parseFloat(document.getElementById('femalePopulation').value);
            
            if (male && female) {
                const sexRatio = (male / female) * 100;
                document.getElementById('sexRatioResult').textContent = `${sexRatio.toFixed(1)}`;
            }
        }

        function calculateDoublingTime() {
            const growthRate = parseFloat(document.getElementById('growthRateDoubling').value);
            
            if (isNaN(growthRate) || growthRate <= 0) {
                showCustomAlert('Please enter a positive growth rate');
                return;
            }
            
            const doublingTime = 70 / growthRate;
            document.getElementById('doublingTimeResult').textContent = `${doublingTime.toFixed(1)} years`;
        }

        // Advanced Demographic Indicators
        function calculateTFR() {
            const asfrInput = document.getElementById('asfrRates').value;
            if (!asfrInput.trim()) return;
            
            const asfr = asfrInput.split(',').map(rate => parseFloat(rate.trim())).filter(rate => !isNaN(rate));
            const tfr = asfr.reduce((sum, rate) => sum + rate, 0) * 5;
            
            document.getElementById('tfrResult').textContent = `${tfr.toFixed(2)} children per woman`;
        }

        function calculateGFR() {
            const births = parseFloat(document.getElementById('gfrBirths').value);
            const women = parseFloat(document.getElementById('women15to49').value);
            
            if (births && women) {
                const gfr = (births / women) * 1000;
                document.getElementById('gfrResult').textContent = `${gfr.toFixed(1)} per 1,000`;
            }
        }

        function calculateGRR() {
            const asfrInput = document.getElementById('femaleASFR').value;
            if (!asfrInput.trim()) return;
            
            const asfr = asfrInput.split(',').map(rate => parseFloat(rate.trim())).filter(rate => !isNaN(rate));
            const grr = asfr.reduce((sum, rate) => sum + rate, 0) * 5;
            
            document.getElementById('grrResult').textContent = `${grr.toFixed(3)} daughters per woman`;
        }

        function calculateNRR() {
            const asfrInput = document.getElementById('nrrASFR').value;
            const survivalInput = document.getElementById('survivalRatios').value;
            
            if (!asfrInput.trim() || !survivalInput.trim()) return;
            
            const asfr = asfrInput.split(',').map(rate => parseFloat(rate.trim())).filter(rate => !isNaN(rate));
            const survival = survivalInput.split(',').map(rate => parseFloat(rate.trim())).filter(rate => !isNaN(rate));
            
            if (asfr.length !== survival.length) {
                showCustomAlert('Number of ASFR values must match survival ratios');
                return;
            }
            
            const nrr = asfr.reduce((sum, rate, index) => sum + (rate * survival[index]), 0) * 5;
            document.getElementById('nrrResult').textContent = `${nrr.toFixed(3)}`;
        }

        function calculateIMR() {
            const infantDeaths = parseFloat(document.getElementById('infantDeaths').value);
            const liveBirths = parseFloat(document.getElementById('liveBirths').value);
            
            if (infantDeaths && liveBirths) {
                const imr = (infantDeaths / liveBirths) * 1000;
                document.getElementById('imrResult').textContent = `${imr.toFixed(1)} per 1,000`;
            }
        }

        function calculateCMR() {
            const under5Deaths = parseFloat(document.getElementById('under5Deaths').value);
            const liveBirths = parseFloat(document.getElementById('cmrLiveBirths').value);
            
            if (under5Deaths && liveBirths) {
                const cmr = (under5Deaths / liveBirths) * 1000;
                document.getElementById('cmrResult').textContent = `${cmr.toFixed(1)} per 1,000`;
            }
        }

        function calculateMMR() {
            const maternalDeaths = parseFloat(document.getElementById('maternalDeaths').value);
            const liveBirths = parseFloat(document.getElementById('mmrLiveBirths').value);
            
            if (maternalDeaths && liveBirths) {
                const mmr = (maternalDeaths / liveBirths) * 100000;
                document.getElementById('mmrResult').textContent = `${mmr.toFixed(0)} per 100,000`;
            }
        }

        function calculateNMR() {
            const immigration = parseFloat(document.getElementById('immigration').value);
            const emigration = parseFloat(document.getElementById('emigration').value);
            const population = parseFloat(document.getElementById('totalPopMigration').value);
            
            if (immigration !== undefined && emigration !== undefined && population) {
                const netMigration = immigration - emigration;
                const nmr = (netMigration / population) * 1000;
                document.getElementById('nmrResult').textContent = `${nmr.toFixed(1)} per 1,000`;
            }
        }

        function calculateMGT() {
            const fertilityInput = document.getElementById('ageSpecificFertility').value;
            if (!fertilityInput.trim()) return;
            
            // Parse age-weighted fertility rates
            const ageWeighted = fertilityInput.split(',').map(expr => {
                const result = eval(expr.trim());
                return isNaN(result) ? 0 : result;
            });
            
            const numerator = ageWeighted.reduce((sum, val) => sum + val, 0) * 5;
            
            // Calculate TFR for denominator
            const asfrInput = document.getElementById('asfrRates').value;
            if (!asfrInput.trim()) {
                showCustomAlert('Please calculate TFR first');
                return;
            }
            
            const asfr = asfrInput.split(',').map(rate => parseFloat(rate.trim())).filter(rate => !isNaN(rate));
            const tfr = asfr.reduce((sum, rate) => sum + rate, 0) * 5;
            
            if (tfr > 0) {
                const mgt = numerator / tfr;
                document.getElementById('mgtResult').textContent = `${mgt.toFixed(1)} years`;
            }
        }

        // Population Pyramid Functions
        function generatePyramid() {
            const title = document.getElementById('pyramidTitle').value || 'Population Pyramid - Zimbabwe';
            const type = document.getElementById('pyramidType').value;
            
            let pyramidData;
            
            switch(type) {
                case 'expansive':
                    pyramidData = generateExpansivePyramid();
                    break;
                case 'constrictive':
                    pyramidData = generateConstrictivePyramid();
                    break;
                case 'stationary':
                    pyramidData = generateStationaryPyramid();
                    break;
                case 'excel':
                    if (excelData && excelData.context === 'pyramidDataFile') {
                        pyramidData = processExcelPyramidData();
                    } else {
                        showCustomAlert('Please upload Excel data first');
                        return;
                    }
                    break;
                default:
                    pyramidData = generateExpansivePyramid();
            }
            
            displayPyramid(pyramidData, title);
            analyzePyramid(pyramidData, type);
        }

        function generateExpansivePyramid() {
            const ageGroups = ['0-4', '5-9', '10-14', '15-19', '20-24', '25-29', '30-34', '35-39', '40-44', '45-49', '50-54', '55-59', '60-64', '65-69', '70-74', '75-79', '80+'];
            const maleData = [8.5, 7.8, 7.2, 6.8, 6.5, 6.0, 5.5, 5.0, 4.5, 4.0, 3.5, 3.0, 2.5, 2.0, 1.5, 1.0, 0.5];
            const femaleData = [8.0, 7.5, 7.0, 6.5, 6.2, 5.8, 5.3, 4.8, 4.3, 3.8, 3.3, 2.8, 2.3, 1.8, 1.3, 0.8, 0.4];
            
            return { ageGroups, maleData, femaleData };
        }

        function generateConstrictivePyramid() {
            const ageGroups = ['0-4', '5-9', '10-14', '15-19', '20-24', '25-29', '30-34', '35-39', '40-44', '45-49', '50-54', '55-59', '60-64', '65-69', '70-74', '75-79', '80+'];
            const maleData = [4.0, 4.2, 4.5, 5.0, 5.5, 6.0, 6.5, 7.0, 7.2, 7.0, 6.8, 6.5, 6.0, 5.5, 4.5, 3.0, 2.0];
            const femaleData = [3.8, 4.0, 4.3, 4.8, 5.3, 5.8, 6.2, 6.8, 7.0, 6.8, 6.6, 6.3, 5.8, 5.3, 4.3, 2.8, 1.8];
            
            return { ageGroups, maleData, femaleData };
        }

        function generateStationaryPyramid() {
            const ageGroups = ['0-4', '5-9', '10-14', '15-19', '20-24', '25-29', '30-34', '35-39', '40-44', '45-49', '50-54', '55-59', '60-64', '65-69', '70-74', '75-79', '80+'];
            const maleData = [6.0, 6.0, 6.0, 6.0, 6.0, 6.0, 6.0, 6.0, 5.8, 5.5, 5.0, 4.5, 4.0, 3.5, 3.0, 2.0, 1.0];
            const femaleData = [5.8, 5.8, 5.8, 5.8, 5.8, 5.8, 5.8, 5.8, 5.6, 5.3, 4.8, 4.3, 3.8, 3.3, 2.8, 1.8, 0.8];
            
            return { ageGroups, maleData, femaleData };
        }

        function displayPyramid(data, title) {
            if (charts.pyramid) {
                charts.pyramid.destroy();
            }
            
            const ctx = document.getElementById('populationPyramid').getContext('2d');
            
            charts.pyramid = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.ageGroups,
                    datasets: [
                        {
                            label: 'Male',
                            data: data.maleData.map(val => -val),
                            backgroundColor: '#5D5CDE',
                            borderColor: '#5D5CDE',
                            borderWidth: 1
                        },
                        {
                            label: 'Female',
                            data: data.femaleData,
                            backgroundColor: '#EC4899',
                            borderColor: '#EC4899',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: {
                        title: {
                            display: true,
                            text: title
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                callback: function(value) {
                                    return Math.abs(value) + '%';
                                }
                            }
                        }
                    }
                }
            });
        }

        function analyzePyramid(data, type) {
            const totalMale = data.maleData.reduce((sum, val) => sum + val, 0);
            const totalFemale = data.femaleData.reduce((sum, val) => sum + val, 0);
            const sexRatio = (totalMale / totalFemale) * 100;
            
            const youth = (data.maleData.slice(0, 3).reduce((sum, val) => sum + val, 0) + 
                          data.femaleData.slice(0, 3).reduce((sum, val) => sum + val, 0)) / 
                         (totalMale + totalFemale) * 100;
                         
            const elderly = (data.maleData.slice(-4).reduce((sum, val) => sum + val, 0) + 
                            data.femaleData.slice(-4).reduce((sum, val) => sum + val, 0)) / 
                           (totalMale + totalFemale) * 100;
            
            let interpretation = '';
            switch(type) {
                case 'expansive':
                    interpretation = 'Expansive pyramid indicates high birth rates and young population structure. Typical of developing countries with rapid population growth.';
                    break;
                case 'constrictive':
                    interpretation = 'Constrictive pyramid shows declining birth rates and aging population. Common in developed countries with low fertility.';
                    break;
                case 'stationary':
                    interpretation = 'Stationary pyramid represents stable population with balanced age structure and replacement-level fertility.';
                    break;
            }
            
            document.getElementById('pyramidAnalysis').innerHTML = `
                <div class="bg-primary bg-opacity-10 p-4 rounded-lg">
                    <h4 class="font-bold text-primary mb-2">Sex Ratio</h4>
                    <p class="text-2xl font-bold text-primary">${sexRatio.toFixed(1)}</p>
                    <p class="text-sm text-gray-600 dark:text-gray-400">Males per 100 females</p>
                </div>
                <div class="bg-accent bg-opacity-10 p-4 rounded-lg">
                    <h4 class="font-bold text-accent mb-2">Youth Population</h4>
                    <p class="text-2xl font-bold text-accent">${youth.toFixed(1)}%</p>
                    <p class="text-sm text-gray-600 dark:text-gray-400">Ages 0-14</p>
                </div>
                <div class="bg-warning bg-opacity-10 p-4 rounded-lg">
                    <h4 class="font-bold text-warning mb-2">Elderly Population</h4>
                    <p class="text-2xl font-bold text-warning">${elderly.toFixed(1)}%</p>
                    <p class="text-sm text-gray-600 dark:text-gray-400">Ages 65+</p>
                </div>
                <div class="md:col-span-3 bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                    <h4 class="font-bold text-gray-900 dark:text-white mb-2">Interpretation</h4>
                    <p class="text-sm text-gray-700 dark:text-gray-300">${interpretation}</p>
                </div>
            `;
        }

        // Life Table Functions
        function loadSampleMortality() {
            document.getElementById('mortalityRates').value = '8.5, 1.2, 0.3, 0.4, 0.5, 0.6, 0.8, 1.0, 1.5, 2.5, 4.0, 6.5, 10.5, 16.8, 27.2, 44.7, 73.6, 121.7';
        }

        function constructLifeTable() {
            const ratesInput = document.getElementById('mortalityRates').value;
            const popType = document.getElementById('populationType').value;
            const radix = parseInt(document.getElementById('radix').value) || 100000;
            
            if (!ratesInput.trim()) {
                showCustomAlert('Please enter mortality rates');
                return;
            }
            
            const mx = ratesInput.split(',').map(rate => parseFloat(rate.trim()) / 1000).filter(rate => !isNaN(rate));
            
            if (mx.length === 0) {
                showCustomAlert('Invalid mortality rates');
                return;
            }
            
            const lifeTable = calculateLifeTable(mx, radix);
            displayLifeTable(lifeTable, popType);
            displayLifeTableSummary(lifeTable);
        }

        function calculateLifeTable(mx, radix) {
            const ageGroups = ['0-1', '1-4', '5-9', '10-14', '15-19', '20-24', '25-29', '30-34', '35-39', '40-44', '45-49', '50-54', '55-59', '60-64', '65-69', '70-74', '75-79', '80+'];
            const n = [1, 4, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5];
            
            const lifeTable = [];
            let lx = radix;
            
            for (let i = 0; i < mx.length; i++) {
                const nMx = mx[i];
                const nAx = i === 0 ? 0.1 : (i === 1 ? 1.5 : n[i] / 2);
                const nQx = (n[i] * nMx) / (1 + (n[i] - nAx) * nMx);
                const nDx = lx * nQx;
                const nLx = (lx - nDx) * n[i] + nDx * nAx;
                
                let Tx = 0;
                for (let j = i; j < mx.length; j++) {
                    if (j === mx.length - 1) {
                        Tx += lx / mx[j];
                        break;
                    } else {
                        const tempLx = j === i ? lx : calculateTempLx(mx, radix, j);
                        const tempNQx = (n[j] * mx[j]) / (1 + (n[j] - (j === 0 ? 0.1 : (j === 1 ? 1.5 : n[j] / 2))) * mx[j]);
                        const tempNDx = tempLx * tempNQx;
                        const tempNLx = (tempLx - tempNDx) * n[j] + tempNDx * (j === 0 ? 0.1 : (j === 1 ? 1.5 : n[j] / 2));
                        Tx += tempNLx;
                    }
                }
                
                const ex = Tx / lx;
                
                lifeTable.push({
                    ageGroup: ageGroups[i] || `${i * 5}-${i * 5 + 4}`,
                    nMx: nMx.toFixed(5),
                    nQx: nQx.toFixed(5),
                    lx: Math.round(lx),
                    nDx: Math.round(nDx),
                    nLx: Math.round(nLx),
                    Tx: Math.round(Tx),
                    ex: ex.toFixed(2)
                });
                
                lx = lx - nDx;
                if (lx <= 0) break;
            }
            
            return lifeTable;
        }

        function calculateTempLx(mx, radix, upToIndex) {
            let lx = radix;
            const n = [1, 4, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5];
            
            for (let i = 0; i < upToIndex; i++) {
                const nAx = i === 0 ? 0.1 : (i === 1 ? 1.5 : n[i] / 2);
                const nQx = (n[i] * mx[i]) / (1 + (n[i] - nAx) * mx[i]);
                const nDx = lx * nQx;
                lx = lx - nDx;
                if (lx <= 0) break;
            }
            
            return lx;
        }

        function displayLifeTable(lifeTable, popType) {
            const display = document.getElementById('lifeTableDisplay');
            
            let html = `
                <table class="min-w-full text-sm text-left text-gray-500 dark:text-gray-400">
                    <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
                        <tr>
                            <th class="px-6 py-3">Age Group</th>
                            <th class="px-6 py-3">nMx</th>
                            <th class="px-6 py-3">nQx</th>
                            <th class="px-6 py-3">lx</th>
                            <th class="px-6 py-3">nDx</th>
                            <th class="px-6 py-3">nLx</th>
                            <th class="px-6 py-3">Tx</th>
                            <th class="px-6 py-3">ex</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            lifeTable.forEach((row, index) => {
                html += `
                    <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 ${index % 2 === 0 ? 'bg-gray-50 dark:bg-gray-900' : ''}">
                        <td class="px-6 py-4 font-medium">${row.ageGroup}</td>
                        <td class="px-6 py-4">${row.nMx}</td>
                        <td class="px-6 py-4">${row.nQx}</td>
                        <td class="px-6 py-4">${row.lx}</td>
                        <td class="px-6 py-4">${row.nDx}</td>
                        <td class="px-6 py-4">${row.nLx}</td>
                        <td class="px-6 py-4">${row.Tx}</td>
                        <td class="px-6 py-4 font-bold text-primary">${row.ex}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            display.innerHTML = html;
        }

        function displayLifeTableSummary(lifeTable) {
            const summary = document.getElementById('lifeTableSummary');
            const lifeExpectancy = lifeTable[0].ex;
            const infantMortality = (parseFloat(lifeTable[0].nQx) * 1000).toFixed(1);
            
            summary.innerHTML = `
                <div class="space-y-4">
                    <div class="bg-primary bg-opacity-10 p-4 rounded-lg text-center">
                        <h4 class="font-bold text-primary mb-2">Life Expectancy at Birth</h4>
                        <p class="text-3xl font-bold text-primary">${lifeExpectancy}</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">years</p>
                    </div>
                    
                    <div class="bg-danger bg-opacity-10 p-4 rounded-lg text-center">
                        <h4 class="font-bold text-danger mb-2">Infant Mortality Rate</h4>
                        <p class="text-2xl font-bold text-danger">${infantMortality}</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">per 1,000 births</p>
                    </div>
                    
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                        <h4 class="font-bold text-gray-900 dark:text-white mb-2">Key Insights</h4>
                        <ul class="text-sm text-gray-700 dark:text-gray-300 space-y-1">
                            <li>• Probability of surviving to age 65: ${(100 - parseFloat(lifeTable.slice(0, 13).reduce((sum, row) => sum + parseFloat(row.nQx), 0)) * 100).toFixed(1)}%</li>
                            <li>• Most deaths occur in: ${lifeTable.reduce((max, row) => parseFloat(row.nDx) > parseFloat(max.nDx) ? row : max).ageGroup} age group</li>
                            <li>• Radix used: ${lifeTable[0].lx.toLocaleString()}</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        // Population Projections
        function calculateProjections() {
            const baseYear = parseInt(document.getElementById('baseYear').value);
            const targetYear = parseInt(document.getElementById('targetYear').value);
            const basePop = parseFloat(document.getElementById('basePopulation').value);
            const birthRate = parseFloat(document.getElementById('birthRate').value) / 1000;
            const deathRate = parseFloat(document.getElementById('deathRate').value) / 1000;
            const migrationRate = parseFloat(document.getElementById('migrationRate').value) / 1000;
            
            if (!baseYear || !targetYear || !basePop) {
                showCustomAlert('Please fill in all required fields');
                return;
            }
            
            const years = targetYear - baseYear;
            const growthRate = birthRate - deathRate + migrationRate;
            
            const projections = calculateExponentialProjection(basePop, growthRate, years, baseYear);
            
            processedResults.projections = projections;
            displayProjectionSummary(projections, targetYear);
            updateProjectionChart(projections);
        }

        function calculateExponentialProjection(basePop, growthRate, years, baseYear) {
            const projections = [];
            
            for (let i = 0; i <= years; i++) {
                const population = basePop * Math.exp(growthRate * i);
                projections.push({
                    year: baseYear + i,
                    population: Math.round(population),
                    growthRate: growthRate * 100
                });
            }
            
            return projections;
        }

        function displayProjectionSummary(projections, targetYear) {
            const summary = document.getElementById('projectionSummary');
            const finalProjection = projections[projections.length - 1];
            const initialProjection = projections[0];
            const totalGrowth = ((finalProjection.population - initialProjection.population) / initialProjection.population) * 100;
            const annualGrowthRate = (Math.pow(finalProjection.population / initialProjection.population, 1 / (projections.length - 1)) - 1) * 100;
            
            summary.innerHTML = `
                <div class="space-y-4">
                    <div class="bg-primary bg-opacity-10 p-4 rounded-lg text-center">
                        <h4 class="font-bold text-primary mb-2">Projected Population ${targetYear}</h4>
                        <p class="text-3xl font-bold text-primary">${finalProjection.population.toLocaleString()}</p>
                    </div>
                    
                    <div class="bg-accent bg-opacity-10 p-4 rounded-lg text-center">
                        <h4 class="font-bold text-accent mb-2">Total Growth</h4>
                        <p class="text-2xl font-bold text-accent">${totalGrowth.toFixed(1)}%</p>
                    </div>
                    
                    <div class="bg-secondary bg-opacity-10 p-4 rounded-lg text-center">
                        <h4 class="font-bold text-secondary mb-2">Annual Growth Rate</h4>
                        <p class="text-2xl font-bold text-secondary">${annualGrowthRate.toFixed(2)}%</p>
                    </div>
                    
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                        <h4 class="font-bold text-gray-900 dark:text-white mb-2">Projection Details</h4>
                        <div class="text-sm text-gray-700 dark:text-gray-300 space-y-1">
                            <p>Base Population: ${initialProjection.population.toLocaleString()}</p>
                            <p>Projection Period: ${projections.length - 1} years</p>
                            <p>Population Change: ${(finalProjection.population - initialProjection.population).toLocaleString()}</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function updateProjectionChart(projections) {
            if (charts.projection) {
                charts.projection.destroy();
            }
            
            const ctx = document.getElementById('projectionChart').getContext('2d');
            
            charts.projection = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: projections.map(p => p.year),
                    datasets: [{
                        label: 'Projected Population',
                        data: projections.map(p => p.population),
                        borderColor: '#5D5CDE',
                        backgroundColor: 'rgba(93, 92, 222, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Population Projection'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            ticks: {
                                callback: function(value) {
                                    return (value / 1000000).toFixed(1) + 'M';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Excel Data Processing Functions
        function processBasicCalculations(data) {
            // Auto-populate basic calculation fields from Excel data
            if (data.headers.includes('births') || data.headers.includes('Births')) {
                const birthsCol = data.headers.findIndex(h => h.toLowerCase().includes('birth'));
                if (birthsCol >= 0 && data.data[0] && data.data[0][birthsCol]) {
                    document.getElementById('totalBirths').value = data.data[0][birthsCol];
                }
            }
            
            if (data.headers.includes('deaths') || data.headers.includes('Deaths')) {
                const deathsCol = data.headers.findIndex(h => h.toLowerCase().includes('death'));
                if (deathsCol >= 0 && data.data[0] && data.data[0][deathsCol]) {
                    document.getElementById('totalDeaths').value = data.data[0][deathsCol];
                }
            }
            
            if (data.headers.includes('population') || data.headers.includes('Population')) {
                const popCol = data.headers.findIndex(h => h.toLowerCase().includes('population'));
                if (popCol >= 0 && data.data[0] && data.data[0][popCol]) {
                    document.getElementById('totalPopBirth').value = data.data[0][popCol];
                    document.getElementById('totalPopDeath').value = data.data[0][popCol];
                }
            }
            
            // Auto-calculate rates
            setTimeout(() => {
                calculateCBR();
                calculateCDR();
            }, 100);
        }

        function processComprehensiveIndicators(data) {
            const results = document.getElementById('comprehensiveExcelResults');
            results.classList.remove('hidden');
            
            // Process and calculate multiple indicators from Excel data
            const indicators = [];
            
            // Try to calculate various indicators based on available columns
            if (data.headers.some(h => h.toLowerCase().includes('birth')) && 
                data.headers.some(h => h.toLowerCase().includes('population'))) {
                
                const birthsCol = data.headers.findIndex(h => h.toLowerCase().includes('birth'));
                const popCol = data.headers.findIndex(h => h.toLowerCase().includes('population'));
                
                if (data.data[0] && data.data[0][birthsCol] && data.data[0][popCol]) {
                    const cbr = (data.data[0][birthsCol] / data.data[0][popCol]) * 1000;
                    indicators.push({
                        name: 'Crude Birth Rate',
                        value: `${cbr.toFixed(1)} per 1,000`,
                        color: 'accent'
                    });
                }
            }
            
            displayBatchIndicators(indicators);
        }

        function displayBatchIndicators(indicators) {
            const container = document.getElementById('excelIndicatorResults');
            let html = '';
            
            indicators.forEach(indicator => {
                html += `
                    <div class="bg-${indicator.color} bg-opacity-10 p-4 rounded-lg text-center">
                        <h4 class="font-bold text-${indicator.color} mb-2">${indicator.name}</h4>
                        <p class="text-xl font-bold text-${indicator.color}">${indicator.value}</p>
                    </div>
                `;
            });
            
            if (html) {
                container.innerHTML = html;
            }
        }

        function processMainExcelData(data) {
            const preview = document.getElementById('excelDataPreview');
            showExcelPreview(data, 'mainExcelFile');
            
            // Show processing options
            const options = document.getElementById('excelProcessingOptions');
            options.classList.remove('hidden');
        }

        function processExcelData() {
            if (!excelData) {
                showCustomAlert('Please upload Excel file first');
                return;
            }
            
            const results = document.getElementById('batchResults');
            results.innerHTML = `
                <div class="bg-primary bg-opacity-10 p-6 rounded-lg">
                    <h4 class="font-bold text-primary mb-4">Processing Complete</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div class="text-center">
                            <i class="fas fa-check-circle text-accent text-2xl mb-2"></i>
                            <p class="font-medium">Data Processed</p>
                            <p class="text-sm text-gray-600 dark:text-gray-400">${excelData.data.length} rows</p>
                        </div>
                        <div class="text-center">
                            <i class="fas fa-chart-bar text-secondary text-2xl mb-2"></i>
                            <p class="font-medium">Indicators Calculated</p>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Ready for analysis</p>
                        </div>
                        <div class="text-center">
                            <i class="fas fa-file-pdf text-danger text-2xl mb-2"></i>
                            <p class="font-medium">Report Ready</p>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Generate PDF report</p>
                        </div>
                    </div>
                </div>
            `;
        }

        // Additional Demographic Indicators Functions
        function calculateTotalPop() {
            const population = parseFloat(document.getElementById('totalPopulation').value);
            const year = document.getElementById('popRefYear').value;
            
            if (population) {
                document.getElementById('totalPopResult').textContent = `${population.toLocaleString()} (${year})`;
            }
        }

        function calculatePopDensity() {
            const population = parseFloat(document.getElementById('popForDensity').value);
            const area = parseFloat(document.getElementById('totalArea').value);
            
            if (population && area) {
                const density = population / area;
                document.getElementById('densityResult').textContent = `${density.toFixed(1)} per km²`;
            }
        }

        function calculateNaturalIncrease() {
            const birthRate = parseFloat(document.getElementById('birthRateNI').value);
            const deathRate = parseFloat(document.getElementById('deathRateNI').value);
            
            if (birthRate && deathRate) {
                const naturalIncrease = birthRate - deathRate;
                document.getElementById('naturalIncreaseResult').textContent = `${naturalIncrease.toFixed(1)} per 1,000`;
            }
        }

        // Advanced Survival Analysis Models
        function calculateGompertzSurvival(age, alpha, beta) {
            // Gompertz survival function: S(x) = exp(-β * (e^(αx) - 1) / α)
            return Math.exp(-beta * (Math.exp(alpha * age) - 1) / alpha);
        }

        function calculateSMAAM(attributes, weights) {
            // Simplified SMAAM calculation
            if (attributes.length !== weights.length) return null;
            
            let weightedSum = 0;
            let totalWeights = 0;
            
            for (let i = 0; i < attributes.length; i++) {
                weightedSum += attributes[i] * weights[i];
                totalWeights += weights[i];
            }
            
            return weightedSum / totalWeights;
        }

        function calculateSullivanMethod(mortality, disability) {
            // Sullivan method for calculating healthy life expectancy
            const healthyYears = mortality.map((m, i) => m * (1 - (disability[i] || 0)));
            return healthyYears.reduce((sum, years) => sum + years, 0);
        }

        // Survivorship Curve Functions
        function generateSurvivorshipCurve(type) {
            const agePoints = Array.from({length: 101}, (_, i) => i);
            let survivalRates = [];
            
            switch(type) {
                case 'typeI': // High survival early/middle, drop in later years (humans)
                    survivalRates = agePoints.map(age => {
                        if (age < 60) return 1 - (age * 0.005);
                        else return Math.max(0, 1 - Math.pow((age - 60) / 40, 2));
                    });
                    break;
                case 'typeII': // Constant mortality rate (some birds)
                    survivalRates = agePoints.map(age => Math.exp(-0.02 * age));
                    break;
                case 'typeIII': // High early mortality (fish, plants)
                    survivalRates = agePoints.map(age => Math.exp(-0.1 * Math.sqrt(age)));
                    break;
            }
            
            return { ages: agePoints, survival: survivalRates };
        }

        // Report Generation
        function generateDemographicReport() {
            const title = document.getElementById('reportTitle').value || 'Demographic Analysis Report - Zimbabwe';
            const date = document.getElementById('analysisDate').value || new Date().toISOString().split('T')[0];
            const type = document.getElementById('reportType').value;
            
            // Enhanced report generation with jsPDF
            showCustomAlert(`Generating ${type} demographic report: "${title}" for ${date}\n\nErasmus Gwidza - MSc Population Informatics & Analytics, UZ\n\nAdvanced Demographic Analytics Platform`);
        }

        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            // Set current date as default
            document.getElementById('analysisDate').value = new Date().toISOString().split('T')[0];
            
            // Setup Excel file handlers
            setupExcelHandlers();
            
            // Set up pyramid type change handler
            const pyramidType = document.getElementById('pyramidType');
            if (pyramidType) {
                pyramidType.addEventListener('change', function() {
                    const uploadDiv = document.getElementById('pyramidExcelUpload');
                    if (this.value === 'excel') {
                        uploadDiv.classList.remove('hidden');
                    }
                });
            }
        });
    </script>
</body>
</html>
